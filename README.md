# Yoga Application

Yoga is an online platform for a yoga studio that enables the planning of yoga sessions and the participation of users in these sessions. Users can create their accounts and note their participation in existing sessions. They can also revoke their participation if they no longer wish to participate.

The back-end application (Java and Spring Boot) is being tested via JUnit 5 and Mockito. The front-end application (Angular) is being tested via Jest. The coverage is 80% with integration tests covering at least 30% percent of all tests. End-to-end testing is done via Cypress. For back-end testing the integrated H2 relational database is provided.

Coverage reports can be generated by following the given instructions.

## Table of Contents

1.  Prerequisites  

2.  Clone the Project from GitHub

3.  Database Setup

4.  Back-end Setup

5.  Front-end Setup
  
6.  Testing the Application Manually

7. Running the automated tests and generating the coverage reports 

8.  Technologies and Libraries Used  

10.  Troubleshooting  

## Prerequisites

Before running the application, you need to have the following tools installed on your machine:

-   **Node.js** (version 16)  
   https://nodejs.org/  
    To check if Node.js is already installed, run:  
    `node -v`
    
-   **Angular CLI** (version 14)  
    To install Angular CLI globally, run the following command:  
    `npm install -g @angular/cli`  
      
-   **MySQL** (for database setup)  	 	
	https://dev.mysql.com/downloads/installer/  
    To check if MySQL is installed, open the MySQL application on your computer (for example, MySQL Workbench or the MySQL Command Line Client). 
    
-   **Java 11** (required for running the backend)  
	https://www.oracle.com/java/technologies/javase-jdk11-downloads.html 
    To check if Java is installed, run:  
    `java -version`
    
-   **Maven** (for managing Java dependencies)  
	https://maven.apache.org/download.cgi  
    To check if Maven is installed, run:   
   ` mvn -v`

## Clone the Project from GitHub

Open your terminal or command prompt. Clone the GitHub repository of the project using the following command:

`git clone https://github.com/Erika-Belicova/yoga`

Replace the username and repository-name with your GitHub username and the project name, respectively.

Navigate into the cloned project directory:

`cd repository-name`

You will see two main folders:

-   **back** for the Spring Boot back-end application
-   **front** for the Angular front-end application  

## Database Setup

Ensure that **MySQL** is installed (as mentioned in the **Prerequisites** section).

### Start MySQL Server
Before running the back-end, ensure that MySQL is running on your machine. 

Open the MySQL application on your computer (for example, MySQL Workbench or the MySQL Command Line Client). Upon opening it, you'll be prompted to enter the root password you set during installation. In MySQL Command Line Client, youâ€™ll then see the MySQL prompt (e.g., mysql>); in MySQL Workbench, a graphical interface will open where you can browse databases and run SQL queries.
  
### Create the Database  
In MySQL, create a new database for your application. You can run the following commands to create and use the database:  
  
```
CREATE DATABASE yoga_db;
USE yoga_db;
```

-   The `CREATE DATABASE` command creates a new database called `yoga_db`.
-   The `USE` command tells MySQL to switch to the newly created database, so any future operations (like creating tables or inserting data) will be done in this database.


### Run the SQL Script to Initialize the Database
Once the database is set up, you need to run the SQL script to initialize the required tables. The SQL script is located at:
 
`back/src/test/resources/data.sql`

Open your MySQL application (such as MySQL Workbench or the MySQL Command Line Client) and do one of the following:

-   In **MySQL Workbench**, go to **File > Open**, navigate to the `script.sql` file, and open it in a new SQL tab. Then click **Execute** (the lightning bolt icon) to run the script.

-   In the **MySQL Command Line Client**, use the `source` command to run the script:

     `source path\to\script.sql`;

      Replace `path\to\script.sql` with the full path to the file on your system.

This will create the necessary tables for the back-end to function correctly.  
  
### Configure Environment Variables
Set the following environment variables in your system to connect the Spring Boot back-end with your MySQL database:

```
DATABASE_USERNAME=your_mysql_username
DATABASE_PASSWORD=your_mysql_password
```

For example, on Windows PowerShell, run:

```
$env:DATABASE_USERNAME="your_mysql_username"
$env:DATABASE_PASSWORD="your_mysql_password"
```
     


-   Replace **your_mysql_username** with your MySQL username (usually **root** if using default settings).
-   Replace **your_mysql_password** with your MySQL password.  

For other operating systems or shells, please refer to your system documentation.

### Configure the Application to Connect to MySQL
You need to ensure that Spring Boot is connected to the database. This is done through the application.properties file.
  
In your **back/src/main/resources/application.properties**, make sure you have the correct database configuration. The Spring Boot application will read the database username and password from **environment variables**.
  
The configuration should look like this:  
  
```
spring.datasource.url=jdbc:mysql://localhost:3306/yoga_db?allowPublicKeyRetrieval=true
spring.datasource.username=${DATABASE_USERNAME}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
```

-   Make sure the name `yoga_db` matches the database you created earlier.
-   The **\${DATABASE_USERNAME}** and **\${DATABASE_PASSWORD}** values will be loaded from your system environment variables.

_____

### Important Notes:
-   **MySQL Running:** MySQL must be running for the back-end to connect to the database. Otherwise the database will fail to connect.  
      
-   **Database Configuration:** The application reads your MySQL username and password from system environment variables named: **DATABASE_USERNAME** and **DATABASE_PASSWORD**. Make sure you set these variables in your environment before running the app.

The database name (e.g., **yoga_db**) is set directly in the spring.datasource.url property inside application.properties. Ensure this matches your MySQL database.

## Back-end Setup

### Generate and Set the JWT Secret Key

The application uses JSON Web Tokens (JWT) for authentication and security. To enable this, you need to define a secret key as a system environment variable. This key is used to sign and verify tokens, ensuring secure user authentication.
 
Set the following environment variable before running the application:
  
`JWT_SECRET_KEY=your_jwt_secret_key`

You can generate a 256-bit secret key for **JWT_SECRET_KEY** from a key generator like https://generate-random.org/encryption-key-generator.

Then, add the following to your **application.properties**:

```
oc.app.jwtSecret=${JWT_SECRET_KEY}
oc.app.jwtExpirationMs=86400000
```
_____

### Install the Back-end

Ensure that you have **Java** and **Maven** installed (as mentioned in the **Prerequisites** section).

Navigate to the **back** folder:

`cd back`

#### Install Back-end Dependencies using Maven:

`mvn clean install`

## Front-end Setup

The front-end part of this project has been pre-configured, and you can run it alongside the back-end for a fully functional application.

Ensure that you have **Node.js** and **Angular CLI** installed (as mentioned in the **Prerequisites** section).

#### Navigate into the front-end project directory:  
  
`cd front`

#### Install front-end dependencies:  

`npm install`

## Testing the Application manually

#### Start the back-end application

Once the dependencies are installed, start the back-end Spring Boot application with:

`mvn spring-boot:run`

The back-end API will be available at http://localhost:3001.

#### Start the front-end application:  
  
`ng serve`

The Angular application will be now available at http://localhost:4200.  

**Open your browser and go to:**  
  
http://localhost:4200

You can log in with the pre-existing admin account:

`Email: yoga@studio.com` 
`Password: test!1234`

## Running the automated tests and generating the coverage reports 

#### Run the Back-end tests

Once the dependencies are installed, run the tests for the back-end application with:

`mvn clean test`

This runs the existing unit and integration tests and generates the coverage reports via JaCoCo.

#### Access the coverage reports

The generated coverage reports for unit and integration tests via JaCoCo can be found here:

`back/target/site`

Open the index.html file for each type of test in the browser to view and interact with the coverage report.

## Technologies, Frameworks, and Libraries Used

#### Back-end:

-   **Java 11:** Programming language for back-end development.  

-   **Spring Boot:** Framework for building the back-end application.  

-   **MySQL:** Relational database used to store application data.

-   **H2:** Relational database used for fast, in-memory testing during development.

-   **Maven:** Dependency management and build automation tool for Java.  

-   **JUnit 5:** Java testing library used to write and run unit tests.

-   **Mockito:** Java mocking library used to create mocks and spies to simulate and verify behavior in unit tests.

- **JaCoCo:** Java code coverage library used to measure how much of your code is covered by tests.

      
#### Front-end:

-   **Angular 14:** JavaScript framework for building the user interface.  
      
-   **Node.js 16:** Required for running Angular applications.  
      
-   **Angular CLI 14:** Command-line interface for managing the Angular project.

-   **Jest:** JavaScript testing library used to write and run unit tests.

-   **Cypress:** End-to-end testing framework used to test web application behavior through real browser interactions.


## Troubleshooting

1.  **Issue:** The back-end or front-end doesnâ€™t start.
  
	**Solution:** Ensure that all dependencies are installed. Run the following:

  -   For back-end: `mvn clean install and mvn spring-boot:run`
    
  -   For front-end: `npm install and ng serve`

2.  **Issue:** API endpoints are not responding.
    
	**Solution:** Check the browser console for any errors. Make sure that the back-end is running at **http://localhost:3001** and that the front-end is correctly pointing to the back-end API.
